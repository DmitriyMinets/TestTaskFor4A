1. ХРАНИМАЯ ПРОЦЕДУРА

    CREATE PROCEDURE TransferMoney
        @N1 varchar(255),
        @N2 varchar(255),
        @S decimal(18,2)
    AS
    BEGIN
        SET NOCOUNT ON;
        BEGIN TRANSACTION;

        DECLARE @CurrentBalance DECIMAL(18, 1)
        SELECT @CurrentBalance = S
        FROM T
        WHERE N = @N1;

        IF @CurrentBalance < @S
        BEGIN
            RAISERROR('Недостаточно средств на счёте %s для перевода.', 16, 1, @N1);
            ROLLBACK TRANSACTION;
            RETURN;
        END;

        UPDATE T SET S = S - @S WHERE N = @N1;
        UPDATE T SET S = S + @S WHERE N = @N2;

        COMMIT TRANSACTION;
        PRINT('Перевод завершился успешно.')
    END;

2. ЗАДАЧА НА ВЫВОД В XML.

    Результатом будет XML-документ, представляющий строки таблицы Purchase.

        <data>
        <row>
            <Id>1</Id>
            <Code>SBR003-202001</Code>
            <Name>Конкурс СМСП</Name>
            <StatusId>45</StatusId>
        </row>
        <row>
            <Id>2</Id>
            <Code>SBR003-202002</Code>
            <Name>Запрос предложений</Name>
            <StatusId>2</StatusId>
        </row>
        </data>

        <data> - является корневым элементом;
        <row> - элементы для каждой строки таблицы Purchase;
        <Id>, <Code>, <Name>, <StatusId> - подэлементы внутри каждого элемента <row>.

3. ЗАДАЧА НА ВАЛИДНОСТЬ XML
    1. Закрывающий тег у объекта PurchaseInfo имеет опечатку.
    2. Символ '<' в объекте PurchaseName должен быть экранирован, т.к. является зарезервированным символов в XML.
    3. <TypeInfo><TypeName>Конкурс</TypeInfo></TypeName> вложенные элементы неправильно закрыты.
    4. <BidCurrency>Российский рубль нет закрывающего тега.
    5. <BuId AccessByOrganization=1>20535</BuId> - значение атрибута должно быть в кавычках
    6. <RequestNo>2<RequestNo> - ошибка в закрывающем теге.

    Исправленный вариант

    <PurchaseInfo>
        <PurchaseId>7380554</PurchaseId>
        <PurchaseCode>SBR031-1910280001</PurchaseCode>
        <PurchaseName>Конкурс с ценой &lt; 500 000 руб.</PurchaseName>
        <TypeInfo>
            <TypeName>Конкурс</TypeName>
        </TypeInfo>
    </PurchaseInfo>
    <BidInfo>
        <BidId>652245</BidId>
        <BidName>Право на заключение договора</BidName>
        <BidNo>1</BidNo>
        <BidPrice>2000000.00</BidPrice>
        <BidCurrency>Российский рубль</BidCurrency>
        <BidCurrencyName>57287</BidCurrencyName>
    </BidInfo>
    <RequestInfo>
        <BuId AccessByOrganization='1'>20535</BuId>
        <RequestBuName>ИП Анар Ростовский</RequestBuName>
        <RequestCreateDate>28.10.2019 17:42</RequestCreateDate>
        <RequestId>157545</RequestId>
        <RequestINN>100000000004</RequestINN>
        <RequestNo>2</RequestNo>
    </RequestInfo>

4. ЗАДАЧА НА ЛОГИКУ
        Скорее всего, причина в том, что не обновляется статус или иным образом не помечаются обработанные записи.
    
5. Вопрос на знание select … join
        1. SELECT * 
        FROM T1
        JOIN T2 ON T1.ID = T2.ID

        2. SELECT *
        FROM T1
        LEFT JOIN T2 ON T1.ID = T2.ID

        3. SELECT *
        FROM T1
        LEFT JOIN T2 ON T1.ID = T2.ID
        WHERE T2.ID IS NULL

6. Как вывести результат запроса в XML?
        SELECT * FROM T
        FOR XML PATH('row') ROOT('data')

7. Как выбрать данные из поля с XML?
        DECLARE @xmlData XML

        SET @xmlData = (
            SELECT * 
            FROM T 
            FOR XML PATH('row'), ROOT('data')
        )

        SELECT 
            RowData.value('(Id)[1]', 'int') AS Id,
            RowData.value('(Code)[1]', 'varchar(255)') AS Code,
            RowData.value('(Name)[1]', 'varchar(255)') AS Name,
            RowData.value('(StatusId)[1]', 'int') AS StatusId,
        FROM @xmlData.nodes('/data/row') AS X(RowData)
        WHERE RowData.value('(StatusId)[1]', 'int') != 3 

8. Что такое hints?
    Hints в SQL представляют собой инструкции(подсказки), которые добавляются к SQL запросам для указания оптимизатору запросов каким образом нужно выполнить запрос.

9. Какие виды блокировок существуют?
    1. Shared(S) - Совмещаемая блокировка.
	Такая блокировка используется для операций чтения данных(SELECT) и запрещает изменять данные другим транзакциям, пока не завершиться чтение данных.
    2. Exclusive(X) - Эксклюзивная блокировка.
        Такая блокировка используется для операций модификации данных (INSERT, UPDATE, DELETE) и запрещает транзакциям одновременный доступ к ресурсу.
    3. Update(U) - Блокировка обновления.
        Такая блокировка используется для предотвращение одновременного изменения данных несколькими транзакциями.
    4. Intent(I) - Блокировка намерения.
        Блокировка используется для установки намерения транзакции установить более жёсткую блокировку.
    5. Schema Modification (Sch-M) - Блокировка изменения схемы.
        Блокировка используется для блокировки схемы для изменений, например для удаление или изменение столбцов.
    6. Bulk Update (BU) - Блокировка массового обновления.
        Блокировка позволяет поддерживать несколько одновременных потоков массовой загрузки данных в таблицу и при это запрещает доступ к любым другим процессам, отличным от массовой загрузки данных.

10. Что такое транзакция?
    Транзакция - это последовательность одного или более SQL операторов, которые выполняются атомарно.

11. Чем delete … от truncate … отличается?

    	delete - удаляет каждую строку из таблицы индивидуально, truncate - удаляет все строки сразу, не обрабатывая каждую строку индивидуально.
        delete - позволяет использовать условия, truncate - нет.
        delete - медленнее, т.к. записывает каждую строку в журнал транзакций, truncate - быстрее, т.к. записывает только страницу освобождения в журнал.
        delete - сохраняет значения автоинкремента, truncate - сбрасывает эти значения.

12. Экономика
        При 60% расходов эти две системы будут эквиваленты.

        Пример:

        Доход 100.000

        Налог в первом случае  100.000 * 6% = 6.000
        Налог во втором случае (100.000 - (100.000 * 60%)) * 15% = 6.000

13. Инженерия   
        Расстояние между столбами равно 0, т.к. расстояние от наивысшей точки, до нижней точки по вертикали равно 100 - 7.9 = 92.1м.
        А длинна кабеля для каждого столба 184.2 / 2 = 92.1м, т.е. кабель провисает строго по вертикали, следовательно расстояние между столбами равно 0.

14. Предметная область
        1. Госзакупки - это организованная система приобретения товаров, выполнения работ и оказания услуг для решения нужд муниципальных и государственных учреждений.
        2. 44 ФЗ - регулирует правила закупок.
        3. 223 ФЗ - так же регулирует правила закупок, но 44 ФЗ действует там, где заказчик на 100% относиться к государственному или муниципальному сектору, а 223 ФЗ - закон для заказчиков с оперд. долей(50%) участия государства, региона или
        муниципального сектора.
        4. Торговые отношения между юридическими лицами.
        5. Заказ товара онлайн.

        Клиент выбирает товары и добавляет их в корзину ---> 
        Оформляет заказ и заполняет данные ---> 
        Обработка заказа ---> 
        Упаковка и отгрузка товара ---> 
        Доставка товара клиенту --->
        Проверка и подтверждение заказа --->
        Оплата и завершения заказа.